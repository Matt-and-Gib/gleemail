name: Compile and Test

on: [push, pull_request]

jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
      - uses: arduino/compile-sketches@v1.0.0
        with:
          fqbn: 'arduino:samd:nano_33_iot'
# Disable unused parameter warnings because we necessarily have "no-action" functions due to our callbacks
          cli-compile-flags: |
            - --build-property
            - compiler.cpp.extra_flags="-Wno-unused-parameter"
          libraries: |
            - name: ArduinoJson
            - name: WiFiNINA
            - name: hd44780
            - name: SdFat
          sketch-paths: 'gleemail.ino'

  test:
    #needs: compile
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: jwlawson/actions-setup-cmake@v1.9
    - name: Run CMake
      run: cmake .
    - name: make
      run: make
    - name: ctests
      run: ctest
