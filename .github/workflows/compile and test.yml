name: Compile and Test

on: [push, pull_request]

concurrency: 
  group: atomic-car
  cancel-in-progress: false


jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: arduino/compile-sketches@v1.0.0
        with:
          fqbn: 'arduino:samd:nano_33_iot'
          cli-compile-flags: |
            - --build-property
            - compiler.cpp.extra_flags="-Wno-unused-parameter"
          libraries: |
            - name: ArduinoJson
            - name: WiFiNINA
            - name: hd44780
            - name: SdFat
          sketch-paths: 'gleemail.ino'

  test:
    #needs: compile
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: jwlawson/actions-setup-cmake@v1.9
    - name: Run CMake
      run: cmake .
    - name: make
      run: make
    - name: ctests
      run: ctest
